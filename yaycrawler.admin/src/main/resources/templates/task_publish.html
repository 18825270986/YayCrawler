<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.springframework.org/schema/jdbc">
<head xmlns:th="http://www.thymeleaf.org" th:include="master::head">
    <title>发布任务</title>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="portlet-body form">
                <form id="taskForm" action="publishTask" method="post">
                    <div class="form-body">
                        <div class="form-group">
                            <input type="text" class="form-control" id="pageUrl" name="pageUrl" required="required"
                                   value="http://floor.0731fdc.com/jggs.php"
                                   placeholder="页面URL"/>
                        </div>
                        <div class="form-group">
                            <label class="control-label">请求方式</label>
                            <select id="requestMethod" name="method" class="bootstrap-select bs-select"
                                    required="required">
                                <option value="GET" selected="selected">get方式</option>
                                <option value="POST">post方式</option>
                                <option value="PUT">put方式</option>
                                <option value="DELETE">delete方式</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="control-label">请求参数（JSON）</label>
                            <ul>
                                <li>
                                    1、分页:"$pagination_分页参数名:{START(开始页码),END(结束页码),STEP(步数)}"。例：$pagination_p:{'START':'1','END':'100','STEP':'1'}
                                </li>
                                <li>2、批量查询:"$array_批量参数名:['xxx','yyy','zzz']"。例：$array_name:['11','12','13','14','15']
                                </li>
                            </ul>
                            <textarea id="urlParamsJson" name="urlParamsJson" class="form-control " rows="3" value=""
                                      placeholder="{&quot;$pagination_p&quot;:{'START':'1','END':'100','STEP':'1'},&quot;$array_name&quot;:['11','12','13','14','15']} "></textarea>
                        </div>
                        <div class="form-group">
                            <label>任务类型</label>
                            <div class="checkbox-list">
                                <label class="checkbox-inline">
                                    <input type="radio" name="jobType" value="once" checked="checked"/>单次任务</label>
                                <label class="checkbox-inline">
                                    <input type="radio" name="jobType" value="regular"/>定时任务 </label>
                            </div>
                        </div>
                        <div class="form-group" id="jobInfoDiv"></div>
                        <div class="form-actions right">
                            <!--<button type="button" class="btn default">Cancel</button>-->
                            <button type="submit" class="btn green">提交</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>
<script th:inline="javascript">
    /*<![CDATA[*/
    $(function () {

        $(":radio").click(function () {
            if ("regular" === $(this).val())
                $("#jobInfoDiv").load(global.contextPath + "/addScheduleJob?random=" + Math.random());
            else $("#jobInfoDiv").empty();
        });


        $('#taskForm').submit(function () {
            var form = $(this);
            var data = {};
            form.serializeArray().map(function (x) {
                data[x.name] = x.value;
            });
            $.ajax({
                type: "Post",
                cache: false,
                contentType: "application/json",
                url: form.attr("action"),
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (result) {     //回调函数，result，返回值
                    alert(result == true ? "提交成功" : "发布失败");
                },
                error: function (msg) {
                    alert(msg);
                }
            });
            return false; //此处必须返回false，阻止常规的form提交
        });
    });

    /*]]>*/
</script>

</body>
</html>